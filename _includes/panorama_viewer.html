<div class="panorama-viewer" style="margin: 30px 0;">
  {% if include.images %}
    <h4>{{ include.title | default: "360° View" }}</h4>
    <div id="panorama-{{ include.id }}" style="width: 100%; height: 400px; border-radius: 8px; overflow: hidden; background-color: #000; position: relative;">
      <div class="panorama-controls" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 10; display: flex; gap: 10px;">
        <button onclick="rotatePanorama('{{ include.id }}', -30)" class="panorama-btn" style="padding: 10px 15px; background-color: rgba(255,255,255,0.8); border: none; border-radius: 4px; cursor: pointer;">← Rotate</button>
        <button onclick="resetPanorama('{{ include.id }}')" class="panorama-btn" style="padding: 10px 15px; background-color: rgba(255,255,255,0.8); border: none; border-radius: 4px; cursor: pointer;">Reset</button>
        <button onclick="rotatePanorama('{{ include.id }}', 30)" class="panorama-btn" style="padding: 10px 15px; background-color: rgba(255,255,255,0.8); border: none; border-radius: 4px; cursor: pointer;">Rotate →</button>
      </div>
      <div class="panorama-image-container" id="panorama-image-{{ include.id }}" style="width: 100%; height: 100%; overflow-x: auto; overflow-y: hidden; white-space: nowrap; cursor: grab;">
        {% assign image_array = include.images | split: ',' %}
        {% for image in image_array %}
          <img src="{{ image | strip }}" alt="Panorama view {{ forloop.index }}" style="height: 100%; display: inline-block; user-select: none;">
        {% endfor %}
      </div>
    </div>
    <p style="margin-top: 10px; font-size: 0.9em; color: #6c757d; text-align: center;">
      Click and drag to explore, or use the rotate buttons
    </p>
  {% endif %}
</div>

<script>
var panoramaRotations = {};

function rotatePanorama(id, degrees) {
  var container = document.getElementById('panorama-image-' + id);
  if (!panoramaRotations[id]) {
    panoramaRotations[id] = 0;
  }
  panoramaRotations[id] += degrees;
  container.scrollLeft = (panoramaRotations[id] / 360) * container.scrollWidth;
}

function resetPanorama(id) {
  panoramaRotations[id] = 0;
  var container = document.getElementById('panorama-image-' + id);
  container.scrollLeft = 0;
}

// Enable drag scrolling
document.addEventListener('DOMContentLoaded', function() {
  var panoramaContainers = document.querySelectorAll('.panorama-image-container');
  panoramaContainers.forEach(function(container) {
    var isDown = false;
    var startX;
    var scrollLeft;
    
    container.addEventListener('mousedown', function(e) {
      isDown = true;
      container.style.cursor = 'grabbing';
      startX = e.pageX - container.offsetLeft;
      scrollLeft = container.scrollLeft;
    });
    
    container.addEventListener('mouseleave', function() {
      isDown = false;
      container.style.cursor = 'grab';
    });
    
    container.addEventListener('mouseup', function() {
      isDown = false;
      container.style.cursor = 'grab';
    });
    
    container.addEventListener('mousemove', function(e) {
      if (!isDown) return;
      e.preventDefault();
      var x = e.pageX - container.offsetLeft;
      var walk = (x - startX) * 2;
      container.scrollLeft = scrollLeft - walk;
    });
  });
});
</script>

<style>
.panorama-image-container::-webkit-scrollbar {
  height: 8px;
}

.panorama-image-container::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.1);
}

.panorama-image-container::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.5);
  border-radius: 4px;
}

.panorama-image-container::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.7);
}
</style>

